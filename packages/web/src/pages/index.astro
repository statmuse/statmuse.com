---
import Layout from '@layouts/main.astro'
import Logo from '@components/logo.astro'
import { listLatestMusings } from '@statmuse/core/musings'
import { listOnboarding } from '@statmuse/core/examples'
import { getImageUrl } from "@statmuse/core/questions"
import { rgbToHex } from '@statmuse/core/color'
import { formatDate } from '@statmuse/core/time'
import { marked } from 'marked'

const musings = await listLatestMusings.execute()
const examples = await listOnboarding.execute()
const banner = examples[Math.floor(Math.random() * examples.length)]
---

<Layout>
  <main
    id="home"
    class="home-layout [--header-height:55px] md:[--header-height:64px]"
  >
    <div class="sidebar hidden md:block min-w-[75px] bg-[#f9f9f9]">
      <sidebar-menu>
        <div
          class="sticky top-0 bg-[#f9f9f9] border-t border-transparent w-[237px]"
        >
          <span
            class="sidebar-hamburger-icon block w-[33px] h-[33px] my-[15.5px] ml-5 cursor-pointer"
          >
          </span><div class="mb-[22px]">
            <ul>
              <li
                class="flex items-center my-0.5 py-1.5 highlight bg-white font-semibold"
              >
                <a
                  class="group flex items-center text-black hover:text-primary hover:no-underline"
                  href="/"
                  style="margin-left: 21px;"
                >
                  <span class="block w-[29px] h-[29px] mr-2 home-icon"></span> Home
                </a>
              </li><li class="flex items-center my-0.5 py-1.5">
                <a
                  class="group flex items-center text-black hover:text-primary hover:no-underline"
                  href="/money"
                  style="margin-left: 21px;"
                >
                  <span class="block w-[29px] h-[29px] mr-2 money-icon"></span> Money
                  Search
                </a>
              </li><li class="flex items-center my-0.5 py-1.5">
                <a
                  class="group flex items-center text-black hover:text-primary hover:no-underline"
                  href="/questions"
                  style="margin-left: 21px;"
                >
                  <span class="block w-[29px] h-[29px] mr-2 trending-icon">
                  </span> Trending
                </a>
              </li><li class="flex items-center my-0.5 py-1.5">
                <a
                  class="group flex items-center text-black hover:text-primary hover:no-underline"
                  href="/players"
                  style="margin-left: 21px;"
                >
                  <span class="block w-[29px] h-[29px] mr-2 gallery-icon">
                  </span> Gallery
                </a>
              </li><li class="flex items-center my-0.5 py-1.5">
                <a
                  class="group flex items-center text-black hover:text-primary hover:no-underline"
                  href="https://shop.statmuse.com"
                  style="margin-left: 21px;"
                >
                  <span class="block w-[29px] h-[29px] mr-2 shop-icon"></span> Shop
                </a>
              </li><li class="flex items-center my-0.5 py-1.5">
                <a
                  class="group flex items-center text-black hover:text-primary hover:no-underline"
                  href="https://blog.statmuse.com/"
                  target="_blank"
                  style="margin-left: 21px;"
                >
                  <span class="block w-[29px] h-[29px] mr-2 blog-icon"></span> Blog
                </a>
              </li>
            </ul>
          </div><div class="mb-[22px]">
            <h3
              class="text-[0.8rem] text-[#969ca1] uppercase tracking-[0.07rem] my-3"
              style="margin-left: 22.5px;"
            >
              Search
            </h3><ul>
              <li class="flex items-center my-0.5 py-1.5">
                <a
                  class="group flex items-center text-black hover:text-primary hover:no-underline"
                  href="/product/examples"
                  style="margin-left: 21px;"
                >
                  <span class="block w-[29px] h-[29px] mr-2 example-icon">
                  </span> Examples
                </a>
              </li><li class="flex items-center my-0.5 py-1.5">
                <a
                  class="group flex items-center text-black hover:text-primary hover:no-underline"
                  href="/product/data"
                  style="margin-left: 21px;"
                >
                  <span class="block w-[29px] h-[29px] mr-2 data-coverage-icon">
                  </span> Data &amp; Glossary
                </a>
              </li>
            </ul>
          </div><div class="mb-[22px]">
            <h3
              class="text-[0.8rem] text-[#969ca1] uppercase tracking-[0.07rem] my-3"
              style="margin-left: 22.5px;"
            >
              Play
            </h3><ul>
              <li class="flex items-center my-0.5 py-1.5">
                <a
                  class="group flex items-center text-black hover:text-primary hover:no-underline"
                  href="https://elementsofbasketball.com/"
                  target="_blank"
                  style="margin-left: 21px;"
                >
                  <span
                    class="block w-[29px] h-[29px] mr-2 elements-bball-icon"
                  >
                  </span> Elements of Bball
                </a>
              </li><li class="flex items-center my-0.5 py-1.5">
                <a
                  class="group flex items-center text-black hover:text-primary hover:no-underline"
                  href="https://hardenmaze.com/"
                  target="_blank"
                  style="margin-left: 21px;"
                >
                  <span class="block w-[29px] h-[29px] mr-2 harden-maze-icon">
                  </span> Harden Maze
                </a>
              </li>
            </ul>
          </div><div class="mb-[22px]">
            <h3
              class="text-[0.8rem] text-[#969ca1] uppercase tracking-[0.07rem] my-3"
              style="margin-left: 22.5px;"
            >
              Company
            </h3><ul>
              <li class="flex items-center my-0.5 py-1.5">
                <a
                  class="group flex items-center text-black hover:text-primary hover:no-underline"
                  href="/company/about"
                  style="margin-left: 21px;"
                >
                  <span class="block w-[29px] h-[29px] mr-2 about-icon"></span> About
                </a>
              </li>
            </ul>
          </div>
        </div></sidebar-menu
      >
    </div>

    <div
      class="main h-[var(--header-height)] px-3 md:px-[21px] bg-white flex items-center sticky md:relative top-0 z-20"
    >
      <div class="min-w-[25px] md:hidden">
        <dropdown-menu hamburger="true"></dropdown-menu>
      </div>

      <div class="flex space-x-5 items-center flex-1 justify-end"></div>
    </div>

    <div class="main content-layout">
      <div class="-mb-[5px] z-10">
        <div class="flex flex-col md:flex-row items-center mt-[55px] md:mt-0">
          <div class="flex-1 mb-[34px] md:-mr-[20px] md:mb-0">
            <Logo />
          </div>
          <img
            class="max-w-[70%] md:max-w-none md:h-[205px] md:pr-[10px]"
            alt={banner.text}
            src={getImageUrl(banner)}
          />
        </div>
      </div>
      <div
        class="content-item-full content-layout mb-5 md:mb-[30px] sticky top-[var(--header-height)] md:top-0 py-[5px] bg-white z-[5]"
      >
        <div class="min-h-[46px]">
          <ask-bar
            action="/ask"
            autosuggest-enabled="true"
            class="unstable"
            context="sports"
            csrf-token="CzZHLDIeYyB8JCQYH04wP3A-AmYjXQApgQjsBNTT9sRLE8Yo5oi6H61K"
            placeholder="Search players, stats or odds"
            query-text=""
            throttle="600"
            ><form accept-charset="UTF-8" action="/ask" method="post">
              <div
                role="combobox"
                aria-haspopup="listbox"
                aria-owns="react-autowhatever-1"
                aria-expanded="false"
                class="relative rounded-lg text-[#191919]"
              >
                <div class="relative group">
                  <textarea
                    class="input appearance-none outline-none resize-none block w-full border border-black rounded-lg p-2.5 focus:shadow-md peer group-hover:shadow-md"
                    autocomplete="off"
                    aria-autocomplete="list"
                    aria-controls="react-autowhatever-1"
                    name="question[query]"
                    placeholder="Search players, stats or odds"
                    required=""
                    enterkeyhint="search"
                    style="height: 46px !important;"
                  >
                  </textarea><input
                    type="submit"
                    class="ask-bar-search-icon absolute bottom-3 right-2.5 block w-5 h-5 cursor-pointer"
                    value=""
                  />
                </div><div
                  id="react-autowhatever-1"
                  role="listbox"
                  class="suggestions-container hidden bg-white w-full px-2 absolute top-full border-x border-x-black border-b border-b-slate-400 rounded-b-lg shadow-md"
                >
                </div>
              </div><input
                name="question[preferred_domain]"
                type="hidden"
                value=""
              /><input
                name="question[conversation_token]"
                type="hidden"
                value=""
              /><input
                name="_csrf_token"
                type="hidden"
                value="CzZHLDIeYyB8JCQYH04wP3A-AmYjXQApgQjsBNTT9sRLE8Yo5oi6H61K"
              />
            </form></ask-bar
          >
        </div>
      </div>
      <div>
        <div class="flex flex-nowrap gap-[5px] mb-2.5">
          <a
            class="flex items-center justify-center border border-primary rounded-md hover:text-white hover:bg-primary hover:no-underline p-[5px] flex-1 bg-primary text-white"
            href="/"
          >
            All
          </a>

          <a
            class="flex items-center justify-center border border-primary rounded-md text-primary hover:text-white hover:bg-primary hover:no-underline p-[5px] flex-1"
            href="/nba"
          >
            NBA
          </a>

          <a
            class="flex items-center justify-center border border-primary rounded-md text-primary hover:text-white hover:bg-primary hover:no-underline p-[5px] flex-1"
            href="/nfl"
          >
            NFL
          </a>

          <a
            class="flex items-center justify-center border border-primary rounded-md text-primary hover:text-white hover:bg-primary hover:no-underline p-[5px] flex-1"
            href="/nhl"
          >
            NHL
          </a>

          <a
            class="flex items-center justify-center border border-primary rounded-md text-primary hover:text-white hover:bg-primary hover:no-underline p-[5px] flex-1"
            href="/mlb"
          >
            MLB
          </a>

          <a
            class="flex items-center justify-center border border-primary rounded-md text-primary hover:text-white hover:bg-primary hover:no-underline p-[5px] flex-1"
            href="/pga"
          >
            PGA
          </a>

          <a
            class="hidden md:flex items-center justify-center border border-secondary rounded-md text-secondary hover:text-white hover:bg-secondary hover:no-underline p-[5px] flex-1"
            style="min-width: fit-content;"
            href="/fantasy"
          >
            Fantasy
          </a>
          <a
            class="hidden md:flex items-center justify-center border border-[#003ca8] rounded-md text-[#003ca8] hover:text-white hover:bg-[#003ca8] hover:no-underline p-[5px] flex-1"
            style="min-width: fit-content;"
            href="/money"
          >
            Money
          </a>
        </div>
        <div class="flex flex-nowrap gap-[5px] mb-2.5 md:hidden">
          <a
            class="flex items-center justify-center border border-secondary rounded-md text-secondary hover:text-white hover:bg-secondary hover:no-underline p-[5px] flex-1"
            style="max-width: fit-content;"
            href="/fantasy"
          >
            Fantasy
          </a>
          <a
            class="flex items-center justify-center border border-[#003ca8] rounded-md text-[#003ca8] hover:text-white hover:bg-[#003ca8] hover:no-underline p-[5px] flex-1"
            style="max-width: fit-content;"
            href="/money"
          >
            Money
          </a>
        </div>
      </div>
      <h3
        class="text-[0.8rem] text-[#969ca1] uppercase tracking-[0.07rem] my-3"
      >
        Stat Stories
      </h3>
      {
        musings.map((musing) => (
          <div class="flex flex-col md:flex-row mb-[30px] cursor-pointer">
            <div
              class="flex items-end justify-center w-full md:w-64 min-h-[10rem] rounded-lg"
              style={`background-color: ${rgbToHex(musing.background_rgba)}`}
            >
              <lazy-img
                class-name="h-36 max-w-full object-contain"
                alt={musing.text_plain}
                src={musing.image_url}
                data-cy-illustration=""
              >
                <a href={`/musings/${musing.friendly_id}`}>
                  <img
                    class="h-36 max-w-full object-contain"
                    alt={musing.text_plain}
                    data-cy-illustration=""
                    style="visibility: unset;"
                    src={musing.image_url}
                  />
                </a>
              </lazy-img>
            </div>
            <div class="flex-1 flex flex-col pt-4 px-2.5 md:px-5" onclick=`location.href='/musings/${musing.friendly_id}';`>
              <div 
                 class="flex-1 leading-snug space-y-4"
                 set:html={marked(musing.text_markdown || '', {
                    gfm: true,
                    breaks: true,
                  })}>
              </div>
              <div class="flex items-center mt-[5px]">
                <content-share href="https://stage.statm.us/e/R3Qtu1vWY">
                  <div class="relative inline-block">
                    <img
                      class="w-[22px]"
                      src="data:image/svg+xml;base64,PHN2ZyBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMi43IDIyLjciIHZpZXdCb3g9IjAgMCAyMi43IDIyLjciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6Izk2OWNhMTtzdHJva2Utd2lkdGg6MS41O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxMCI+PHBhdGggZD0ibTYuNSA4LjkgNC45LTQuOSA0LjggNC44Ii8+PHBhdGggZD0ibTExLjQgNHY5LjEiLz48cGF0aCBkPSJtMy4yIDEzLjJ2NS41aDE2LjN2LTUuNSIvPjwvZz48L3N2Zz4K"
                      alt="share"
                    />
                  </div>
                </content-share>
                <p class="text-[0.8rem] text-[#969ca1] uppercase tracking-[0.07rem] my-3 ml-[20px]">
                  {formatDate(musing.publish_at, 'MMMM Do, YYYY')}
                </p>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </main>
</Layout>
