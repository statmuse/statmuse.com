---
import Grid from '@components/grid.astro'
import MoneyLayout from '@layouts/money.astro'
import { Caching } from '@lib/caching'
import { getAssetProfile } from '@lib/kanedama'
import { NOT_FOUND_404 } from '@lib/response'
import dayjs from 'dayjs'
import relativeTime from 'dayjs/plugin/relativeTime'
dayjs.extend(relativeTime)

const { symbol } = Astro.params
if (!symbol) return NOT_FOUND_404

const profile = await getAssetProfile(symbol)
if (!profile) return NOT_FOUND_404

const { annualFinancials, quarterlyFinancials, earningsCalls } =
  profile.stockProfile.financials

const meta = {
  title: `${
    profile.asset.canonicalName || profile.asset.officialName
  } Financials`,
}

Caching.swr(Astro)
---

<MoneyLayout {meta} {profile}>
  <div>
    <div>
      {
        quarterlyFinancials ? (
          <div class="mb-5">
            <Grid
              padding="py-1"
              title="Quarterly Financials"
              data={quarterlyFinancials}
            />
          </div>
        ) : null
      }
      {
        annualFinancials ? (
          <div class="mb-5">
            <Grid
              padding="py-1"
              title="Annual Financials"
              data={annualFinancials}
            />
          </div>
        ) : null
      }
      {
        earningsCalls ? (
          <div class="mb-5">
            <Grid padding="py-1" data={earningsCalls} />
          </div>
        ) : null
      }
    </div>
  </div>
</MoneyLayout>
