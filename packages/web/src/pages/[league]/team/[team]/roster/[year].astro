---
import TeamLayout from '@layouts/team.astro'
import Grid from '@components/grid.astro'

import type { GameraDomain } from '@statmuse/core/gamera'
import { getTeamSeasonBio, getTeamSeasonRoster } from '@lib/team'
import { getLeagueKeywords } from '@lib/meta'

const { league, team, year } = Astro.params
if (!team || !league || !year) {
  return new Response(null, { status: 404, statusText: 'Not found' })
}

const domain = league.toUpperCase() as GameraDomain
const bio = await getTeamSeasonBio({ domain, team, year })
const roster = await getTeamSeasonRoster({ domain, team, year })
if (!bio || !roster) {
  return new Response(null, { status: 404, statusText: 'Not found' })
}

const title = `${year} ${bio.name} Roster`
const description = `The ${year} ${bio.name} roster for the ${domain} regular season and playoffs`
const keywords = `${getLeagueKeywords(domain)} ${year} ${
  bio.name
} team roster stats statistics`
const meta = { title, description, keywords }
---

<TeamLayout {bio} {meta}>
  <div class="mb-5">
    {
      roster?.grid && (
        <Grid
          data={roster?.grid}
          columnStyles={{ 'NO.': 'text-left' }}
          columnHeaderStyles={{ NAME: 'pl-10' }}
        />
      )
    }
  </div>
</TeamLayout>
