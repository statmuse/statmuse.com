---
import Layout from '@layouts/main.astro'
import Header from '@components/header.astro'
import Hero from '@components/hero.astro'
import Visuals from '@components/visuals.astro'
import { handleResponse } from '@statmuse/core/gamera'
import { ask } from '@lib/gamera'

const { league } = Astro.params
const query = Astro.url.searchParams.get('q')
if (!query) return Astro.redirect('/questions')
const question = query?.replaceAll('-', ' ')
const response = await ask(league, question)
const { subject, redirectUrl } = await handleResponse(response)
if (redirectUrl) return Astro.redirect(redirectUrl)
---

<Layout colors={subject?.colors}>
  <Header />
  <Hero {response} {question} />
  <Visuals {response} />
</Layout>
