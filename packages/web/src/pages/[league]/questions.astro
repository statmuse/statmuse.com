---
import BaseLayout from '@layouts/base.astro'
import Header from '@components/header.astro'
import Footer from '@components/footer.astro'
import AskIndex from '@components/ask-index.astro'
import { getAsksIndex } from '@statmuse/core/ask'
import type { AnalyticsPageviewProperties } from '@lib/analytics'
import { parseSearchParams } from '@lib/asks'
import { Caching } from '@lib/caching'

const league = Astro.params.league as string
const searchParams = parseSearchParams(Astro.url.searchParams)
const asks = await getAsksIndex([league], searchParams)

const meta = {
  title: `${league.toUpperCase()} Stats`,
  description: `Instant answers to your ${league.toUpperCase()} questions. Stats, scores, schedules, standings, recaps and more â€” just ask.`,
  pageType: "question"
}

Caching.swr(Astro)
---

<BaseLayout
  {meta}
  analytics={{
    page_type: 'question',
    page_domain: league as AnalyticsPageviewProperties['page_domain'],
  }}
>
  <Header preferredDomain={league} />
  <AskIndex
    selected={league}
    headline={`Trending ${league.toUpperCase()} Searches`}
    {asks}
    {searchParams}
  />
  <Footer />
</BaseLayout>
