---
import BaseLayout from '@layouts/base.astro'
import Header from '@components/header.astro'
import Footer from '@components/footer.astro'
import AskIndex from '@components/ask-index.astro'
import { getAsksIndex } from '@statmuse/core/ask'
import type { AnalyticsPageviewProperties } from '@lib/analytics'
import { parseSearchParams } from '@lib/asks'
import { Caching } from '@lib/caching'
import { leagueToDomain, type LeagueParam } from '@lib/params'

const league = Astro.params.league as LeagueParam
const domain = leagueToDomain(league)
const searchParams = parseSearchParams(Astro.url.searchParams)
const asks = await getAsksIndex([domain.toLowerCase()], searchParams)

const meta = {
  title: `${domain === 'EPL' ? 'Premier League' : domain} Stats`,
  description: `Instant answers to your ${
    domain === 'EPL' ? 'Premier League' : domain
  } questions. Stats, scores, schedules, standings, recaps and more â€” just ask.`,
  pageType: 'question',
}

Caching.swr(Astro)
---

<BaseLayout
  {meta}
  analytics={{
    page_type: 'question',
    page_domain:
      domain.toLowerCase() as AnalyticsPageviewProperties['page_domain'],
  }}
>
  <Header preferredDomain={domain.toLowerCase()} />
  <AskIndex
    selected={league}
    headline={`Trending ${
      domain === 'EPL' ? 'Premier League' : domain
    } Searches`}
    {asks}
    {searchParams}
  />
  <Footer />
</BaseLayout>
