---
import Timestamp from '@components/timestamp.svelte'
import Share from '@components/share/index.svelte'
import { hexToHSL } from '@lib/color'
import Image from '@components/image.astro'
import type { MlbGameDataResponse } from '@statmuse/core/gamera'
import Score from './score.svelte'
import Panel from '@components/panel.astro'
import { inningNumber } from './stores'

interface Props {
  awayTeam?: NonNullable<MlbGameDataResponse['teams']>[number]
  homeTeam?: NonNullable<MlbGameDataResponse['teams']>[number]
  awayRecord?: { wins: number; losses: number }
  homeRecord?: { wins: number; losses: number }
  timestamp: string
}

const { awayTeam, homeTeam, awayRecord, homeRecord, timestamp } = Astro.props
---

<Panel
  class:list={{
    '!p-0 -mx-3 md:mx-0': true,
    'rounded-none border-0 md:rounded-2xl': true,
    '!bg-gray-7 dark:!bg-gray-2 md:!bg-gray-8 md:dark:!bg-gray-3': true,
  }}
>
  <div class="h-[45px] flex px-3 py-2 justify-center relative">
    <p class="text-gray-5 absolute left-3 top-2">
      <Timestamp client:only="svelte" {timestamp} dateOnly />
    </p>
    <p>Final{inningNumber.get() !== 9 ? `/${inningNumber.get()}` : ''}</p>
    <div class="absolute right-3 top-2">
      <Share />
    </div>
  </div>
  <div class="flex h-20 overflow-clip">
    <div
      class="flex-1 flex relative justify-end text-right"
      style={{
        background: hexToHSL(awayTeam?.colors?.backgroundColor ?? '', 0.2),
        color: awayTeam?.colors?.foregroundColor,
      }}
    >
      <Image
        src={awayTeam?.logoImageUrl ?? ''}
        alt={awayTeam?.name ?? ''}
        width={140}
        height={140}
        class="absolute left-0 h-full object-contain -translate-x-1/2"
      />
      <div class="px-3 flex flex-col justify-center leading-none">
        <h4 class="font-semibold text-lg">
          {
            awayRecord && (
              <span class="text-sm font-normal">{`${awayRecord.wins}-${awayRecord.losses}`}</span>
            )
          }{' '}{awayTeam?.abbreviation}
        </h4>
        <p class="text-2xl"><Score teamKey="away" /></p>
      </div>
    </div>
    <div
      class="flex-1 flex relative"
      style={{
        background: hexToHSL(homeTeam?.colors?.backgroundColor ?? '', 0.2),
        color: homeTeam?.colors?.foregroundColor,
      }}
    >
      <Image
        src={homeTeam?.logoImageUrl ?? ''}
        alt={homeTeam?.name ?? ''}
        width={140}
        height={140}
        class="absolute right-0 h-full object-contain translate-x-1/2"
      />
      <div class="px-3 flex flex-col justify-center leading-none">
        <h4 class="font-semibold text-lg">
          {homeTeam?.abbreviation}{' '}{
            homeRecord && (
              <span class="text-sm font-normal">{`${homeRecord.wins}-${homeRecord.losses}`}</span>
            )
          }
        </h4>
        <p class="text-2xl"><Score teamKey="home" /></p>
      </div>
    </div>
  </div>
  <slot />
</Panel>
