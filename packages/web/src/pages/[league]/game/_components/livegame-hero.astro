---
import Inning from './inning.svelte'
import Share from '@components/share/index.svelte'
import { hexToHSL } from '@lib/color'
import Image from '@components/image.astro'
import type {
  GameResultsResponse,
  MlbGameDataResponse,
} from '@statmuse/core/gamera'

interface Props {
  network: string
  awayTeam?: NonNullable<MlbGameDataResponse['teams']>[number]
  homeTeam?: NonNullable<MlbGameDataResponse['teams']>[number]
  awayScores?: GameResultsResponse
  homeScores?: GameResultsResponse
  awayScore: number
  homeScore: number
  halfInning: string
  inning: number
  outs: number
}

const getTeamFromGameResult = (
  teamId?: number,
  game?: GameResultsResponse['games'][number],
) => {
  return game?.awayTeam.teamId === teamId
    ? game?.awayTeam
    : game?.homeTeam.teamId === teamId
    ? game?.homeTeam
    : undefined
}

const {
  network,
  awayTeam,
  homeTeam,
  awayScores,
  homeScores,
  awayScore,
  homeScore,
  halfInning,
  inning,
  outs,
} = Astro.props

const awayTeamRecord = getTeamFromGameResult(
  awayTeam?.teamId,
  awayScores?.games[0],
)?.record
const homeTeamRecord = getTeamFromGameResult(
  homeTeam?.teamId,
  homeScores?.games[0],
)?.record
---

<div class="-mx-3">
  <div
    class="h-[45px] flex bg-gray-6 dark:bg-gray-4 px-3 py-2 justify-center relative"
  >
    <p class="text-gray-5 absolute left-3 top-2">{network}</p>
    <Inning client:load {halfInning} {inning} {outs} />
    <div class="absolute right-3 top-2">
      <Share />
    </div>
  </div>
  <div class="flex h-20 overflow-clip">
    <div
      class="flex-1 flex relative justify-end text-right"
      style={{
        background: hexToHSL(awayTeam?.colors?.backgroundColor ?? '', 0.2),
        color: awayTeam?.colors?.foregroundColor,
      }}
    >
      <Image
        src={awayTeam?.logoImageUrl ?? ''}
        alt={awayTeam?.name ?? ''}
        width={140}
        height={140}
        class="absolute left-0 h-full object-contain -translate-x-1/2"
      />
      <div class="px-3 flex flex-col justify-center leading-none">
        <h4 class="font-semibold text-lg">
          {
            awayTeamRecord && (
              <span class="text-sm font-normal">{`${awayTeamRecord.wins}-${awayTeamRecord.losses}`}</span>
            )
          }{' '}{awayTeam?.abbreviation}
        </h4>
        <p class="text-2xl">{awayScore}</p>
      </div>
    </div>
    <div
      class="flex-1 flex relative"
      style={{
        background: hexToHSL(homeTeam?.colors?.backgroundColor ?? '', 0.2),
        color: homeTeam?.colors?.foregroundColor,
      }}
    >
      <Image
        src={homeTeam?.logoImageUrl ?? ''}
        alt={homeTeam?.name ?? ''}
        width={140}
        height={140}
        class="absolute right-0 h-full object-contain translate-x-1/2"
      />
      <div class="px-3 flex flex-col justify-center leading-none">
        <h4 class="font-semibold text-lg">
          {homeTeam?.abbreviation}{' '}{
            homeTeamRecord && (
              <span class="text-sm font-normal">{`${homeTeamRecord.wins}-${homeTeamRecord.losses}`}</span>
            )
          }
        </h4>
        <p class="text-2xl">{homeScore}</p>
      </div>
    </div>
  </div>
</div>
