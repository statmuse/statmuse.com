---
import Image from "@components/image.astro"
import { rgbToHex } from "@statmuse/core/color";
import { listLatestMusings } from "@statmuse/core/musings"
import { formatDate } from "@statmuse/core/time";
import { marked } from "marked";

const musings = await listLatestMusings.execute()
---
<Fragment>
  <h3
    class="text-[0.8rem] text-[#969ca1] uppercase tracking-[0.07rem] my-3"
  >
    Stat Stories 
  </h3>
  {
    musings.map((musing, i) => (
      <div class="flex flex-col md:flex-row mb-[30px] cursor-pointer">
        <div
          class="flex items-end justify-center w-full md:w-64 min-h-[10rem] rounded-lg"
          style={`background-color: ${rgbToHex(musing.background_rgba)}`}
        >
            <a href={`/musings/${musing.friendly_id}`}>
              <Image
                data-cy-illustration
                class="h-36 max-w-full object-contain object-bottom"
                style="visibility: unset;"
                alt={musing.text_plain}
                src={musing.image_url!}
                width={192}
                height={192}
                loading={i < 4 ? "eager" : "lazy"}
              />
            </a>
        </div>
        <div class="flex-1 flex flex-col pt-4 px-2.5 md:px-5" onclick=`location.href='/musings/${musing.friendly_id}';`>
          <div 
             class="flex-1 leading-snug space-y-4"
             set:html={marked(musing.text_markdown || '', {
                gfm: true,
                breaks: true,
                mangle: false,
                headerIds: false
              })}>
          </div>
          <div class="flex items-center mt-[5px]">
            <content-share href="https://stage.statm.us/e/R3Qtu1vWY">
              <div class="relative inline-block">
                <img
                  class="w-[22px]"
                  src="data:image/svg+xml;base64,PHN2ZyBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMi43IDIyLjciIHZpZXdCb3g9IjAgMCAyMi43IDIyLjciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6Izk2OWNhMTtzdHJva2Utd2lkdGg6MS41O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxMCI+PHBhdGggZD0ibTYuNSA4LjkgNC45LTQuOSA0LjggNC44Ii8+PHBhdGggZD0ibTExLjQgNHY5LjEiLz48cGF0aCBkPSJtMy4yIDEzLjJ2NS41aDE2LjN2LTUuNSIvPjwvZz48L3N2Zz4K"
                  alt="share"
                />
              </div>
            </content-share>
            <p class="text-[0.8rem] text-[#969ca1] uppercase tracking-[0.07rem] my-3 ml-[20px]">
              {formatDate(musing.publish_at, 'MMMM Do, YYYY')}
            </p>
          </div>
        </div>
      </div>
    ))
  }
</Fragment>
