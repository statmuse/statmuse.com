---
import Icon from '@components/icon.svelte'
import Panel from '@components/panel.astro'
import DayNavigation from './day-navigation.svelte'
import AditudeAdBanner from '@components/aditude-ad-banner.svelte'
import Nav from '@components/nav.astro'
import type { GameraDomain } from '@statmuse/core/gamera'
import dayjs from 'dayjs'
import utc from 'dayjs/plugin/utc'
import timezone from 'dayjs/plugin/timezone'
import DatePicker from './date-picker.svelte'

dayjs.extend(utc)
dayjs.extend(timezone)

interface Props {
  days: string[]
  selectedDay: string
  domain?: GameraDomain
}

const { days, selectedDay, domain } = Astro.props

const leageNavLinks = [
  {
    text: 'All',
    href: '/scores' + Astro.url.search,
    param: 'all',
  },
  {
    text: 'MLB',
    href: '/mlb/scores' + Astro.url.search,
    param: 'mlb',
  },
]

const date = dayjs(selectedDay).tz(Astro.locals.timezone, true)
const today = dayjs().tz(Astro.locals.timezone)
---

{
  Astro.locals.platform === 'native' ? (
    <Panel
      class:list={{
        'rounded-none border-t-0': true,
        '-mx-3 pb-2 pt-8 px-3 whitespace-nowrap': true,
      }}
    >
      <div class="flex items-center gap-3 mb-3">
        <DatePicker
          client:load
          class="w-5 h-5"
          basePath={Astro.url.pathname}
          defaultDate={Astro.url.searchParams.get('date')}
        />
        <nav
          class:list={{
            'flex gap-3 overflow-x-scroll no-scrollbar': true,
            '-mx-3 px-3': true,
          }}
        >
          {leageNavLinks.map((link) => (
            <a
              class:list={{
                'p-1 px-3 text-center whitespace-nowrap border rounded-full': true,
                'bg-teal text-gray-8 border-teal':
                  (domain?.toLowerCase() ?? 'all') === link.param,
                'bg-gray-7 dark:bg-gray-2 text-inherit border-gray-6 dark:border-none':
                  (domain?.toLowerCase() ?? 'all') !== link.param,
              }}
              href={link.href ?? ''}
              set:html={link.text}
            />
          ))}
        </nav>
      </div>
      <DayNavigation
        client:load
        class="-mb-3 -mx-3"
        {days}
        selectedDate={date.toISOString()}
        basePath={Astro.url.pathname}
      />
    </Panel>
  ) : (
    <div class="@container/hero flex flex-col gap-3">
      <Panel
        class:list={{
          'rounded-none border-0 md:rounded-2xl': true,
          '-mx-3 pb-2 pt-4 px-3 @lg/hero:py-3 @lg/hero:px-5 md:mx-0 whitespace-nowrap': true,
        }}
        team
      >
        <div class="relative text-center @lg/hero:text-left">
          <span class="absolute left-0 top-1/2 -translate-y-1/2 @lg/hero:hidden">
            <DatePicker
              client:load
              class="w-5 h-5"
              basePath={Astro.url.pathname}
              defaultDate={Astro.url.searchParams.get('date')}
            />
          </span>
          <h1 class="text-2xl font-semibold">Scores</h1>
        </div>
        <DayNavigation
          client:load
          class="@lg/hero:hidden -mb-3"
          {days}
          selectedDate={date.toISOString()}
          basePath={Astro.url.pathname}
        />
        <Nav
          class="hidden @lg/hero:flex -mb-3"
          hero
          links={leageNavLinks}
          selected={domain ? domain.toLowerCase() : 'all'}
        />
        <div class="hidden @lg/hero:flex gap-3 items-center absolute right-3 bottom-2.5">
          <div class="w-32 py-0.5 px-2 rounded-2xl flex justify-between items-center bg-team-secondary text-team-primary">
            <a
              href={`${Astro.url.pathname}?${new URLSearchParams({
                date: date.subtract(1, 'day').format('YYYY-MM-DD'),
              }).toString()}`}
              class="text-inherit"
            >
              <Icon name="next" class="w-4 h-4 rotate-180" />
            </a>
            {date.date() === today.date()
              ? 'Today'
              : date.date() === today.subtract(1, 'day').date()
              ? 'Yesterday'
              : date.date() === today.add(1, 'day').date()
              ? 'Tomorrow'
              : date.format('ddd MMM D')}
            <a
              href={`${Astro.url.pathname}?${new URLSearchParams({
                date: date.add(1, 'day').format('YYYY-MM-DD'),
              }).toString()}`}
              class="text-inherit"
            >
              <Icon name="next" class="w-4 h-4" />
            </a>
          </div>
          <DatePicker
            client:load
            class="w-5 h-5"
            basePath={Astro.url.pathname}
            defaultDate={Astro.url.searchParams.get('date')}
            placement="bottom-end"
          />
        </div>
      </Panel>
      {Astro.locals.platform === 'web' ? (
        <div class="md:hidden h-[50px] md:h-[90px] flex justify-center items-center">
          <AditudeAdBanner
            client:only="svelte"
            divId="pb-slot-anchor"
            slotId="pb-slot-anchor"
            placeholderClass="w-[320px] md:w-[728px] h-[50px] md:h-[90px]"
            onlyMobile
          />
        </div>
      ) : null}
      <Nav
        class="@lg/hero:hidden"
        links={leageNavLinks}
        selected={domain ? domain.toLowerCase() : 'all'}
      />
    </div>
  )
}
