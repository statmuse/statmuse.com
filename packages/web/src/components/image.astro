---
import { Image as AstroImage, type RemoteImageProps } from 'astro:assets'
import { cdnBaseUrl, type GameraResponse } from '@statmuse/core/gamera'
import type { Answer } from '@statmuse/core/question'

interface Props extends Omit<RemoteImageProps, 'src'> {
  src: string | { answer: Answer }
}

const getUrl = (src: string | { answer: Answer }) => {
  if (typeof src === 'string') return src
  const answer = src.answer as GameraResponse
  const subject = answer.visual.summary.subject
  return subject.imageUrl
}

const getImageUrl = (src: string | { answer: Answer }) => {
  const raw = getUrl(src)
  const url = raw.startsWith('http') ? raw : `${cdnBaseUrl}/${raw}`
  return url
}

const src = getImageUrl(Astro.props.src)
---

<AstroImage {...Astro.props} {src} />
