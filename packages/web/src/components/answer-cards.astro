---
import { getPlayerCards, getTeamCards } from '@lib/related-content'
import type {
  PlayerCardResponse,
  TeamCardResponse,
} from '@statmuse/core/gamera'

interface Props {
  domain: string
}

const { domain } = Astro.props

const lastName = (s: string) => {
  const names = s.split(' ')
  return names[names.length - 1]
}

const playerCardTitle = (title: string) => {
  switch (title) {
    // NBA Player
    case 'mostPointsPerGame':
      return 'PPG Leaders'
    case 'mostReboundsPerGame':
      return 'RPG Leaders'
    case 'mostAssistsPerGame':
      return 'APG Leaders'
    case 'mostStealsPerGame':
      return 'SPG Leaders'
    case 'mostBlocksPerGame':
      return 'BPG Leaders'
    case 'mostThreePointersMadePerGame':
      return '3PM Leaders'
    case 'bestTrueShootingPercentage':
      return 'TS% Leaders'
    // NFL Player
    case 'mostPassingYards':
      return 'Pass Yards Leaders'
    case 'mostRushingYards':
      return 'Rush Yards Leaders'
    case 'mostReceivingYards':
      return 'Rec Yards Leaders'
    case 'mostPassingTouchdowns':
      return 'Pass TD Leaders'
    case 'mostRushingTouchdowns':
      return 'Rush TD Leaders'
    case 'mostReceivingTouchdowns':
      return 'Rec TD Leaders'
    case 'bestQuarterbackRating':
      return 'QB Rating Leaders'
    case 'mostDefensiveSacks':
      return 'Sack Leaders'
    // NHL Player
    case 'mostGoals':
      return 'Goals Leaders'
    case 'mostAssists':
      return 'Assists Leaders'
    case 'mostPoints':
      return 'Points Leaders'
    case 'bestPlusMinus':
      return '+/- Leaders'
    case 'bestGoalsAgainstAverage':
      return 'Goals Against Leaders'
    // EPL Player
    case 'mostGoals':
      return 'Goals Leaders'
    case 'mostAssists':
      return 'Assists Leaders'
    case 'mostShotsOnTarget':
      return 'Shots on Target Leaders'
    case 'mostPasses':
      return 'Passes Leaders'
    case 'mostTackles':
      return 'Tackles Leaders'
    case 'mostCleanSheets':
      return 'Clean Sheets Leaders'
    default:
      return title
  }
}

const teamCardTitle = (title: string) => {
  switch (title) {
    // NBA Team
    case 'bestOffensiveRating':
      return 'ORtg Rankings'
    case 'bestDefensiveRating':
      return 'DRtg Rankings'
    case 'bestNetRating':
      return 'NetRtg Rankings'
    case 'worstRecord':
      return 'Tank Leaderboard'
    // NFL Team
    case 'mostPointsPerGame':
      return 'PPG Rankings'
    case 'leastPointsAllowedPerGame':
      return 'Opp PPG Rankings'
    case 'mostTotalYardsPerGame':
      return 'Total Yards Rankings'
    case 'mostRushingYardsPerGame':
      return 'Rush Yards Rankings'
    case 'mostPassingYardsPerGame':
      return 'Pass Yards Rankings'
    case 'mostDefensiveSacks':
      return 'Sack Leaders'
    // NHL Team
    case 'mostGoalsPerGame':
      return 'Goals Rankings'
    case 'leastGoalsAllowedPerGame':
      return 'Goals Against Rankings'
    case 'bestPowerPlayPercentage':
      return 'Power Play Rankings'
    case 'bestPenaltyKillPercentage':
      return 'Penalty Kill Rankings'
    // EPL Team
    case 'mostGoals':
      return 'Goals For Rankings'
    case 'leastGoalsAgainst':
      return 'Goals Against Rankings'
    case 'bestGoalDifferential':
      return 'Goal Difference Rankings'
    default:
      return title
  }
}

let playerCardsResp: PlayerCardResponse | undefined
let teamCardsResp: TeamCardResponse | undefined

const allowedDomains = ['nba', 'nfl', 'nhl', 'epl', 'mlb']

if (allowedDomains.includes(domain)) {
  playerCardsResp = await getPlayerCards({ context: Astro, domain })
  teamCardsResp = await getTeamCards({ context: Astro, domain })
}
---

{
  playerCardsResp && teamCardsResp && (
    <>
      {playerCardsResp.cards.length > 0 && (
        <Fragment>
          <h3 class="text-3xl font-semibold">
            {`${domain.toUpperCase()} ${
              playerCardsResp.seasonYearDisplay
            } Leaders`}
          </h3>
          <div class="grid grid-cols-[repeat(auto-fit,_minmax(325px,_1fr))] gap-4 mb-5">
            {playerCardsResp?.cards.map((card) => (
              <div class="relative -z-[1]">
                <p class="font-semibold">{playerCardTitle(card.stat)}</p>
                <div
                  class="flex rounded-2xl overflow-hidden"
                  style={{
                    backgroundColor: card.players[0].colors.backgroundColor,
                    color: card.players[0].colors.foregroundColor,
                  }}
                >
                  {card?.players.map((player, i) => (
                    <div class="text-center flex-1 relative h-56">
                      <h3 class="text-3xl mt-3" style="line-height: normal;">
                        {player.statDisplayValue}
                      </h3>
                      <p class="uppercase text-xs tracking-[0.07rem]">
                        {lastName(player.entity.display)}
                      </p>
                      <img
                        src={player.imageUrl}
                        class=" h-36 absolute bottom-0 left-1/2 -translate-x-1/2"
                        style={{ maxWidth: 'initial', zIndex: 3 - i }}
                      />
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </Fragment>
      )}
      {teamCardsResp.cards.length > 0 && (
        <Fragment>
          <h3 class="text-3xl font-semibold">
            {`${domain.toUpperCase()} ${
              teamCardsResp.seasonYearDisplay
            } Rankings`}
          </h3>
          <div class="grid grid-cols-[repeat(auto-fit,_minmax(325px,_1fr))] gap-4 mb-5">
            {teamCardsResp?.cards.map((card) => (
              <div>
                <p class="font-semibold">{teamCardTitle(card.stat)}</p>
                <div
                  class="flex flex-wrap rounded-2xl py-5 gap-y-5"
                  style={{
                    backgroundColor: card.teams[0].colors.backgroundColor,
                    color: card.teams[0].colors.foregroundColor,
                  }}
                >
                  {card.teams.map((team) => (
                    <div class="w-1/3 text-center">
                      <div class="w-16 h-16 rounded-full bg-white flex items-center justify-center mx-auto">
                        <img
                          src={team.logoImageUrl}
                          class="w-4/5 h-4/5 object-contain"
                        />
                      </div>
                      <p class="text-3xl mt-2" style="line-height: normal;">
                        {team.statDisplayValue}
                      </p>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </Fragment>
      )}
    </>
  )
}
