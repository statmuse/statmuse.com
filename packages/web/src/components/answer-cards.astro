---
import { getPlayerCards, getTeamCards } from '@lib/related-content'
import type {
  PlayerCardResponse,
  ScoresResponse,
  ScheduleResponse,
  TeamCardResponse,
  GameraDomain,
} from '@statmuse/core/gamera'
import { getStandings } from '@lib/standings'
import { getGames, getSchedule } from '@lib/game'
import PlayerLeaders from '@components/cards/player-leaders.astro'
import FantasyLeaders from './cards/fantasy-leaders.astro'
import TeamRankings from './cards/team-rankings.astro'
import TeamBetting from './cards/team-betting.astro'
import Standings from './cards/standings.astro'
import ScoresSchedule from './cards/scores-schedule.astro'
import TeamSpecific from './cards/team-specific.astro'

interface Props {
  domain: GameraDomain
  teamId?: number | string
}

const { domain, teamId } = Astro.props

let playerCardsResp: PlayerCardResponse | undefined
let teamCardsResp: TeamCardResponse | undefined
let standingsResp: Awaited<ReturnType<typeof getStandings>> | undefined
let scheduleResp: ScheduleResponse | undefined
let scoresResp: ScoresResponse | undefined

const allowedDomains = ['NBA', 'NFL', 'NHL', 'EPL', 'MLB']

if (allowedDomains.includes(domain)) {
  ;[playerCardsResp, teamCardsResp, standingsResp, scheduleResp, scoresResp] =
    await Promise.all([
      getPlayerCards({ context: Astro, domain }),
      getTeamCards({ context: Astro, domain }),
      getStandings({ context: Astro, domain }),
      getSchedule({ context: Astro, domain }),
      getGames({ context: Astro, domain }),
    ])
}
---

<div class="space-y-10 mb-10">
  <TeamSpecific
    {domain}
    {teamId}
    adSlot={{ slotId: 'pb-slot-1', baseDivId: 'pb-slot-incontent-1' }}
  />
  <PlayerLeaders
    {domain}
    response={playerCardsResp}
    mlbBatting={domain === 'MLB'}
    adSlot={{ slotId: 'pb-slot-2', baseDivId: 'pb-slot-incontent-2' }}
  />
  {
    domain === 'MLB' && (
      <PlayerLeaders
        {domain}
        response={playerCardsResp}
        mlbPitching
        adSlot={{
          slotId: 'pb-slot-2-pitching',
          baseDivId: 'pb-slot-incontent-2',
        }}
      />
    )
  }
  <TeamRankings
    {domain}
    response={teamCardsResp}
    adSlot={{ slotId: 'pb-slot-3', baseDivId: 'pb-slot-incontent-3' }}
  />
  <FantasyLeaders
    {domain}
    response={playerCardsResp}
    adSlot={{ slotId: 'pb-slot-4', baseDivId: 'pb-slot-incontent-4' }}
  />
  <TeamBetting {domain} response={teamCardsResp} />
  <Standings
    {domain}
    response={standingsResp}
    adSlot={{ slotId: 'pb-slot-5', baseDivId: 'pb-slot-incontent-1' }}
  />
  <ScoresSchedule
    {domain}
    scoresResponse={scoresResp}
    scheduleResponse={scheduleResp}
  />
</div>
