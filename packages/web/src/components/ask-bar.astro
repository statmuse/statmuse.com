---
interface Props {
  query?: string
  conversationToken?: string
  preferredDomain?: string
  money?: boolean
}
---

<form
  class="ask-form"
  action={Astro.props.money ? '/money/ask' : '/ask'}
  accept-charset="UTF-8"
  method="post"
>
  <div
    role="combobox"
    aria-haspopup="listbox"
    aria-owns="react-autowhatever-1"
    aria-expanded="false"
    class="relative rounded-lg text-[#191919]"
  >
    <div class="relative group">
      <textarea
        class="ask-textarea input appearance-none outline-none resize-none block w-full border border-black rounded-lg p-2.5 focus:shadow-md peer group-hover:shadow-md"
        autocomplete="off"
        aria-autocomplete="list"
        aria-controls="react-autowhatever-1"
        name="question[query]"
        placeholder={Astro.props.money
          ? 'Search stocks, FX or bitcoin'
          : 'Search players, stats or odds'}
        required=""
        enterkeyhint="search"
        style="height: 46px !important;"
        set:text={Astro.props.query}
      />
      <input
        type="submit"
        class="ask-bar-search-icon absolute bottom-3 right-2.5 block w-5 h-5 cursor-pointer"
        value=""
      />
    </div>
    <div
      id="react-autowhatever-1"
      role="listbox"
      class="suggestions-container hidden bg-white w-full px-2 absolute top-full border-x border-x-black border-b border-b-slate-400 rounded-b-lg shadow-md"
    >
    </div>
  </div>
  <input
    name="question[preferred_domain]"
    type="hidden"
    value={Astro.props.preferredDomain}
  />
  <input
    name="question[conversation_token]"
    type="hidden"
    value={Astro.props.conversationToken}
  />
  <input
    name="_csrf_token"
    type="hidden"
    value="CzZHLDIeYyB8JCQYH04wP3A-AmYjXQApgQjsBNTT9sRLE8Yo5oi6H61K"
  />
</form>

<script>
  document.addEventListener('astro:load', () => {
    const forms = document.querySelectorAll<HTMLFormElement>('form.ask-form')

    const textareas = document.querySelectorAll('textarea.ask-textarea')
    textareas.forEach((textarea) => {
      textarea.addEventListener('keydown', (e) => {
        const event = e as KeyboardEvent

        if (event.keyCode === 13) {
          if (!event.repeat) {
            forms.forEach((form) => form.submit())
          }

          e.preventDefault() // Prevents the addition of a new line in the text field
        }
      })
    })
  })
</script>
