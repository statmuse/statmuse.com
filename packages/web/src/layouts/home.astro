---
import BaseLayout from '@layouts/base.astro'
import MoneyBaseLayout from '@layouts/money-base.astro'
import StandardLogo from '@components/logo.astro'
import MoneyLogo from '@components/logo-money.astro'
import AskBar from '@components/ask-bar.svelte'
import Image from '@components/image.astro'
import Footer from '@components/footer.astro'
import DropdownMenu from '@components/dropdown-menu.astro'
import MenuLinks from '@components/menu-links.astro'
import type { GameraResponse } from '@statmuse/core/gamera'
import type { Metadata } from '@lib/meta'
import type { AnalyticsPageviewProperties } from '@lib/analytics'
import NewsletterSignup from '@components/newsletter-signup.astro'
import AuthMenu from '@components/auth-menu.svelte'
import FreestarVideo from '@components/freestar-video.svelte'
import type { LeagueParam } from '@lib/params'

interface Props {
  league?: LeagueParam
  img: {
    src: string | { answer: GameraResponse }
    text: string
  }
  meta?: Metadata
  colors?: {
    foreground?: string
    background?: string
    foregroundColor?: string
    backgroundColor?: string
  }
}

const { league = 'All', img, ...rest } = Astro.props

const leagueBtns = [
  { text: 'NBA', param: 'nba', href: '/nba' },
  { text: 'NFL', param: 'nfl', href: '/nfl' },
  { text: 'NHL', param: 'nhl', href: '/nhl' },
  { text: 'MLB', param: 'mlb', href: '/mlb' },
  { text: 'Premier League', param: 'fc', href: '/fc' },
  { text: 'PGA', param: 'pga', href: '/pga' },
]

const trendingLinkText = (param: string) => {
  switch (param) {
    case 'All':
      return 'See trending searches'
    case 'money':
      return 'See trending Money searches'
    case 'fantasy':
      return 'See trending Fantasy Football searches'
    case 'fc':
      return 'See trending Premier League searches'
    default:
      return `See trending ${param.toUpperCase()} searches`
  }
}

const Layout = league === 'money' ? MoneyBaseLayout : BaseLayout
const Logo = league === 'money' ? MoneyLogo : StandardLogo
---

<Layout
  {...rest}
  analytics={{
    page_domain:
      league === 'All'
        ? 'unknown'
        : league === 'fantasy'
        ? 'nfl'
        : league === 'money'
        ? 'finance'
        : league === 'fc'
        ? 'epl'
        : (league as AnalyticsPageviewProperties['page_domain']),
  }}
>
  <main
    id="home"
    class="home-layout [--header-height:55px] md:[--header-height:64px]"
  >
    <div class="sidebar hidden lg:block min-w-[75px] bg-[#f9f9f9]">
      <div
        class="sticky top-0 bg-[#f9f9f9] border-t border-transparent w-[237px]"
      >
        <MenuLinks />
      </div>
    </div>

    <div
      class="main h-[var(--header-height)] px-3 lg:px-[21px] bg-white flex items-center sticky lg:relative top-0 z-20"
    >
      <div class="lg:hidden">
        <DropdownMenu />
      </div>

      <div class="flex flex-1 justify-end">
        <AuthMenu client:load />
      </div>
    </div>

    <div class="main content-layout">
      <div class="-mb-[5px]">
        <div class="flex flex-col md:flex-row items-center mt-[55px] md:mt-0">
          <div class="flex-1 mb-[34px] md:-mr-[20px] md:mb-0">
            <Logo />
          </div>
          <Image
            class="max-w-[70%] md:max-w-[260px] md:h-[205px] md:pr-[10px] object-contain object-bottom z-[5]"
            src={img.src}
            alt={img.text}
            width={750}
            height={750}
            loading="eager"
          />
        </div>
      </div>
      <div
        class="content-item-full sticky top-[var(--header-height)] md:top-0 pb-[5px] bg-white"
      >
      </div>
      <div
        class="content-item-full content-layout mb-5 md:mb-[30px] sticky top-[calc(var(--header-height)+5px)] md:top-[5px] pb-[5px] bg-white z-[5]"
      >
        <div>
          <AskBar
            client:load
            money={league === 'money'}
            fantasy={league === 'fantasy'}
            preferredDomain={league === 'All'
              ? undefined
              : league === 'fc'
              ? 'epl'
              : league}
          />
        </div>
      </div>
      <div>
        <div class="flex flex-nowrap gap-[5px] mb-2.5">
          <a
            class:list={[
              'flex items-center justify-center border rounded-md border-primary text-primary hover:text-white hover:bg-primary hover:no-underline p-[5px] flex-1 text-center leading-[1.2]',
              {
                'bg-primary text-white': Astro.url.pathname === '/',
              },
            ]}
            href="/"
            set:text="All"
          />
          {
            leagueBtns.map((btn) => (
              <a
                class:list={[
                  'relative flex items-center justify-center border rounded-md border-primary text-primary hover:text-white hover:bg-primary hover:no-underline p-[5px] flex-1 text-center leading-[1.2]',
                  {
                    'bg-primary text-white': btn.param === league,
                  },
                ]}
                href={btn.href}
                data-beta={btn.text === 'Premier League'}
              >
                {btn.text}
                {btn.text === 'Premier League' && (
                  <svg
                    enable-background="new 0 0 361.9 152.6"
                    viewBox="0 0 361.9 152.6"
                    xmlns="http://www.w3.org/2000/svg"
                    class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-3/4"
                  >
                    <path
                      d="m46.6 25.2h272.8v109.6h-272.8z"
                      fill="#fff"
                      stroke="#fff"
                      stroke-miterlimit="10"
                    />
                    <path
                      d="m285.6 0h-209.3c-42.1 0-76.3 34.2-76.3 76.3s34.2 76.3 76.3 76.3h209.3c42.1 0 76.3-34.2 76.3-76.3s-34.2-76.3-76.3-76.3zm-163.2 115.6h-10.8l-45.4-62.8s.2 10.6.2 20.9v41.9h-11v-78.7h11.6l44.6 61.9s-.1-9.7-.1-20.1v-41.8h10.8v78.7zm68.6 0h-47v-78.7h46.1v9.2h-35v23.5h33.1v9.2h-33.2v27.4h36zm92.7.1h-10.8l-18.9-63.7-18.8 63.7h-10.8l-22.7-78.9h11.6l17 62.1 18.1-62.1h11.3l18.1 62.2 17-62.1h11.6z"
                      fill="#00c1d8"
                    />
                  </svg>
                )}
              </a>
            ))
          }
          <a
            class={`hidden lg:flex items-center justify-center border border-secondary rounded-md text-secondary hover:text-white hover:bg-secondary hover:no-underline p-[5px] flex-1 min-w-fit ${
              league === 'fantasy' && 'bg-secondary text-white'
            }`}
            href="/fantasy"
            set:text="Fantasy"
          />
          <a
            class={`hidden lg:flex items-center justify-center border border-[#003ca8] rounded-md text-[#003ca8] hover:text-white hover:bg-[#003ca8] hover:no-underline p-[5px] flex-1 min-w-fit ${
              league === 'money' && 'bg-[#003ca8] text-white'
            }`}
            href="/money"
            set:text="Money"
          />
        </div>
        <div
          class="flex flex-nowrap gap-[5px] mb-2.5 lg:hidden"
          style={{ height: '50.375px' }}
        >
          <a
            class={`flex items-center justify-center border border-secondary rounded-md text-secondary hover:text-white hover:bg-secondary hover:no-underline p-[5px] flex-1 max-w-fit ${
              league === 'fantasy' && 'bg-secondary text-white'
            }`}
            href="/fantasy"
            set:text="Fantasy"
          />
          <a
            class={`flex items-center justify-center border border-[#003ca8] rounded-md text-[#003ca8] hover:text-white hover:bg-[#003ca8] hover:no-underline p-[5px] flex-1 max-w-fit ${
              league === 'money' && 'bg-[#003ca8] text-white'
            }`}
            href="/money"
            set:text="Money"
          />
        </div>
      </div>
      <div>
        <FreestarVideo
          client:only="svelte"
          class="mb-[30px] mt-[32px] w-full lg:w-[425px]"
          {league}
        />
      </div>
      <slot />
      {
        league !== 'fc' && (
          <h4 class="font-semibold text-right py-4">
            <a href={league === 'All' ? '/questions' : `/${league}/questions`}>
              {trendingLinkText(league)}
            </a>
          </h4>
        )
      }
      <NewsletterSignup />
    </div>
    <div class="main">
      <Footer />
    </div>
  </main>
</Layout>
