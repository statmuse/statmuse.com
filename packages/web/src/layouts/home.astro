---
import BaseLayout from '@layouts/base.astro'
import MoneyBaseLayout from '@layouts/money-base.astro'
import StandardLogo from '@components/logo.astro'
import MoneyLogo from '@components/logo-money.astro'
import AskBar from '@components/ask-bar.svelte'
import Image from '@components/image.astro'
import Footer from '@components/footer.astro'
import DropdownMenu from '@components/dropdown-menu.astro'
import MenuLinks from '@components/menu-links.astro'
import type { GameraResponse } from '@statmuse/core/gamera'
import type { Metadata } from '@lib/meta'
import type { AnalyticsPageviewProperties } from '@lib/analytics'
import NewsletterSignup from '@components/newsletter-signup.astro'
import AuthMenu from '@components/auth-menu.svelte'
import FreestarVideo from '@components/freestar-video.svelte'
import type { LeagueParam } from '@lib/params'

interface Props {
  league?: LeagueParam
  img: {
    src: string | { answer: GameraResponse }
    text: string
  }
  meta?: Metadata
  colors?: {
    foreground?: string
    background?: string
    foregroundColor?: string
    backgroundColor?: string
  }
}

const { league: leagueParam = 'All', img, ...rest } = Astro.props

const leagues = ['All', 'nba', 'nfl', 'nhl', 'mlb', 'pga', 'fc']

const trendingLinkText = (param: string) => {
  switch (param) {
    case 'All':
      return 'See trending searches'
    case 'money':
      return 'See trending Money searches'
    case 'fantasy':
      return 'See trending Fantasy Football searches'
    case 'fc':
      return 'See trending Premier League searches'
    default:
      return `See trending ${param.toUpperCase()} searches`
  }
}

const Layout = leagueParam === 'money' ? MoneyBaseLayout : BaseLayout
const Logo = leagueParam === 'money' ? MoneyLogo : StandardLogo
---

<Layout
  {...rest}
  analytics={{
    page_domain:
      leagueParam === 'All'
        ? 'unknown'
        : leagueParam === 'fantasy'
        ? 'nfl'
        : leagueParam === 'money'
        ? 'finance'
        : leagueParam === 'fc'
        ? 'epl'
        : (leagueParam as AnalyticsPageviewProperties['page_domain']),
  }}
>
  <main
    id="home"
    class="home-layout [--header-height:55px] md:[--header-height:64px]"
  >
    <div class="sidebar hidden lg:block min-w-[75px] bg-[#f9f9f9]">
      <div
        class="sticky top-0 bg-[#f9f9f9] border-t border-transparent w-[237px]"
      >
        <MenuLinks />
      </div>
    </div>

    <div
      class="main h-[var(--header-height)] px-3 lg:px-[21px] bg-white flex items-center sticky lg:relative top-0 z-20"
    >
      <div class="lg:hidden">
        <DropdownMenu />
      </div>

      <div class="flex flex-1 justify-end">
        <AuthMenu client:load />
      </div>
    </div>

    <div class="main content-layout">
      <div class="-mb-[5px]">
        <div class="flex flex-col md:flex-row items-center mt-[55px] md:mt-0">
          <div class="flex-1 mb-[34px] md:-mr-[20px] md:mb-0">
            <Logo />
          </div>
          <Image
            class="max-w-[70%] md:max-w-[260px] md:h-[205px] md:pr-[10px] object-contain object-bottom z-[5]"
            src={img.src}
            alt={img.text}
            width={750}
            height={750}
            loading="eager"
          />
        </div>
      </div>
      <div
        class="content-item-full sticky top-[var(--header-height)] md:top-0 pb-[5px] bg-white"
      >
      </div>
      <div
        class="content-item-full content-layout mb-5 md:mb-[30px] sticky top-[calc(var(--header-height)+5px)] md:top-[5px] pb-[5px] bg-white z-[5]"
      >
        <div>
          <AskBar
            client:load
            money={leagueParam === 'money'}
            fantasy={leagueParam === 'fantasy'}
            preferredDomain={leagueParam === 'All'
              ? undefined
              : leagueParam === 'fc'
              ? 'epl'
              : leagueParam}
          />
        </div>
      </div>
      <div>
        <div class="flex flex-nowrap gap-[5px] mb-2.5">
          {
            leagues.map((league) => (
              <a
                class:list={[
                  'flex items-center justify-center border rounded-md hover:text-white hover:bg-primary hover:no-underline p-[5px] flex-1 text-center leading-[1.2]',
                  {
                    'border-primary text-primary': league !== 'fc',
                    'bg-primary text-white':
                      league === leagueParam && league !== 'fc',
                    'pointer-events-none': league === 'fc',
                    'border-[#c5c9cc] text-[#c5c9cc]': league === 'fc',
                  },
                ]}
                href={league === 'All' ? '/' : `/${league}`}
                set:text={
                  league === 'All'
                    ? league
                    : league === 'fc'
                    ? 'Premier League'
                    : league.toUpperCase()
                }
                data-disabled={league === 'fc'}
              />
            ))
          }
          <a
            class={`hidden lg:flex items-center justify-center border border-secondary rounded-md text-secondary hover:text-white hover:bg-secondary hover:no-underline p-[5px] flex-1 min-w-fit ${
              leagueParam === 'fantasy' && 'bg-secondary text-white'
            }`}
            href="/fantasy"
            set:text="Fantasy"
          />
          <a
            class={`hidden lg:flex items-center justify-center border border-[#003ca8] rounded-md text-[#003ca8] hover:text-white hover:bg-[#003ca8] hover:no-underline p-[5px] flex-1 min-w-fit ${
              leagueParam === 'money' && 'bg-[#003ca8] text-white'
            }`}
            href="/money"
            set:text="Money"
          />
        </div>
        <div
          class="flex flex-nowrap gap-[5px] mb-2.5 lg:hidden"
          style={{ height: '50.375px' }}
        >
          <a
            class={`flex items-center justify-center border border-secondary rounded-md text-secondary hover:text-white hover:bg-secondary hover:no-underline p-[5px] flex-1 max-w-fit ${
              leagueParam === 'fantasy' && 'bg-secondary text-white'
            }`}
            href="/fantasy"
            set:text="Fantasy"
          />
          <a
            class={`flex items-center justify-center border border-[#003ca8] rounded-md text-[#003ca8] hover:text-white hover:bg-[#003ca8] hover:no-underline p-[5px] flex-1 max-w-fit ${
              leagueParam === 'money' && 'bg-[#003ca8] text-white'
            }`}
            href="/money"
            set:text="Money"
          />
        </div>
      </div>
      <div>
        <FreestarVideo
          client:only="svelte"
          class="mb-[30px] mt-[32px] w-full lg:w-[425px]"
          league={leagueParam}
        />
      </div>
      <slot />
      <h4 class="font-semibold text-right py-4">
        <a
          href={leagueParam === 'All'
            ? '/questions'
            : `/${leagueParam}/questions`}
        >
          {trendingLinkText(leagueParam)}
        </a>
      </h4>
      <NewsletterSignup />
    </div>
    <div class="main">
      <Footer />
    </div>
  </main>
</Layout>
