---
import Layout from '@layouts/main.astro'
import Header from '@components/header.astro'
import Container from '@components/container.astro'
import { GameraBoxScore, tokensToHtml } from '@statmuse/core/gamera'
import type { Metadata } from '@lib/meta'
import Hero from '@components/hero.astro'

interface Props {
  data: GameraBoxScore
  meta?: Metadata
}

const { data } = Astro.props
const { league: preferredDomain, game } = Astro.params
if (!game || !preferredDomain) {
  return new Response(null, { status: 404, statusText: 'Not found' })
}

// const domain = league.toUpperCase() as GameraDomain
// const path = Astro.url.pathname
// const canonical = Astro.url.pathname + Astro.url.search
const answer = tokensToHtml(data.nlg.text.answer)
const subject = data.visual.summary.subject
---

<Layout colors={subject?.colors} {...Astro.props.meta ?? {}}>
  <Header {preferredDomain} />
  <Hero
    content={answer}
    imageUrl={subject.imageUrl}
    imageAlt={subject.entities[0].display}
  />
  <Container>
    <slot />
    <div class="mt-6 mb-4">
      <h3 class="text-4xl font-semibold">Explore</h3>
      <ul class="flex flex-wrap gap-1.5" data-cy-related-questions>
        {
          data.visual.additionalQuestions?.map((question) => (
            <li class="flex-1 min-w-[210px] my-1.5 flex gap-1.5 leading-snug">
              <i class="w-5 h-5 shrink-0 explore-search-icon" />
              <a
                href={`/${question.domain.toLowerCase()}/ask?q=${question.text
                  .replaceAll(' ', '+')
                  .toLowerCase()}`}
              >
                {question.text}
              </a>
            </li>
          ))
        }

        <li class="flex-1 min-w-[210px] my-1.5 flex gap-1.5">
          <i class="w-5 h-5 shrink-0 explore-flame-icon"></i>
          <a href={`/${data.visual.domain.toLowerCase()}/questions`}>
            See trending
          </a>
        </li>
      </ul>
    </div>
  </Container>
</Layout>
